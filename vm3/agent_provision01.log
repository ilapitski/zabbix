Bringing machine 'vm3' up with 'virtualbox' provider...
==> vm3: Importing base box 'sbeliakou/centos-6.7-x86_64'...
[KProgress: 20%[KProgress: 30%[KProgress: 40%[KProgress: 50%[KProgress: 60%[KProgress: 70%[KProgress: 80%[KProgress: 90%[K==> vm3: Matching MAC address for NAT networking...
==> vm3: Setting the name of the VM: zabbix-vm3
==> vm3: Fixed port collision for 22 => 2222. Now on port 2202.
==> vm3: Clearing any previously set network interfaces...
==> vm3: Preparing network interfaces based on configuration...
    vm3: Adapter 1: nat
    vm3: Adapter 2: hostonly
==> vm3: Forwarding ports...
    vm3: 22 (guest) => 2202 (host) (adapter 1)
==> vm3: Running 'pre-boot' VM customizations...
==> vm3: Booting VM...
==> vm3: Waiting for machine to boot. This may take a few minutes...
    vm3: SSH address: 127.0.0.1:2202
    vm3: SSH username: vagrant
    vm3: SSH auth method: private key
    vm3: 
    vm3: Vagrant insecure key detected. Vagrant will automatically replace
    vm3: this with a newly generated keypair for better security.
    vm3: 
    vm3: Inserting generated public key within guest...
    vm3: Removing insecure key from the guest if it's present...
    vm3: Key inserted! Disconnecting and reconnecting using new SSH key...
==> vm3: Machine booted and ready!
==> vm3: Checking for guest additions in VM...
==> vm3: Setting hostname...
==> vm3: Configuring and enabling network interfaces...
==> vm3: Mounting shared folders...
    vm3: /vagrant => /home/super_user/zabbix/task2/vm3
==> vm3: Running provisioner: ansible...
    vm3: Running ansible-playbook...
PYTHONUNBUFFERED=1 ANSIBLE_NOCOLOR=true ANSIBLE_HOST_KEY_CHECKING=false ANSIBLE_SSH_ARGS='-o UserKnownHostsFile=/dev/null -o IdentitiesOnly=yes -o ControlMaster=auto -o ControlPersist=60s' ansible-playbook --connection=ssh --timeout=30 --limit='vm3' --inventory-file=/home/super_user/zabbix/task2/vm3/.vagrant/provisioners/ansible/inventory -vv provision_vm3.yml
/home/super_user/.pyenv/libexec/pyenv: line 43: cd: ansible: Not a directory
Using /home/super_user/.ansible.cfg as config file

PLAYBOOK: provision_vm3.yml ****************************************************
1 plays in provision_vm3.yml

PLAY [Provision with Ansible] **************************************************

TASK [setup] *******************************************************************
ok: [vm3]

TASK [debug] *******************************************************************
task path: /home/super_user/zabbix/task2/vm3/provision_vm3.yml:15
ok: [vm3] => {
    "msg": "Vm provision with zabbix-agent"
}

TASK [add a new string at the end of the file] *********************************
task path: /home/super_user/zabbix/task2/vm3/provision_vm3.yml:17
changed: [vm3] => {"backup": "", "changed": true, "msg": "line replaced"}

TASK [install zabbix repo] *****************************************************
task path: /home/super_user/zabbix/task2/vm3/provision_vm3.yml:23
changed: [vm3] => {"changed": true, "msg": "", "rc": 0, "results": ["Loaded plugins: fastestmirror\nSetting up Install Process\nExamining /tmp/tmp2KICUi/zabbix-release-2.4-1.el6.noarch.rpm: zabbix-release-2.4-1.el6.noarch\nMarking /tmp/tmp2KICUi/zabbix-release-2.4-1.el6.noarch.rpm to be installed\nDetermining fastest mirrors\n * base: ftp.byfly.by\n * epel: mirror.datacenter.by\n * extras: ftp.byfly.by\n * updates: ftp.byfly.by\nResolving Dependencies\n--> Running transaction check\n---> Package zabbix-release.noarch 0:2.4-1.el6 will be installed\n--> Finished Dependency Resolution\n\nDependencies Resolved\n\n================================================================================\n Package          Arch     Version     Repository                          Size\n================================================================================\nInstalling:\n zabbix-release   noarch   2.4-1.el6   /zabbix-release-2.4-1.el6.noarch    20 k\n\nTransaction Summary\n================================================================================\nInstall       1 Package(s)\n\nTotal size: 20 k\nInstalled size: 20 k\nDownloading Packages:\nRunning rpm_check_debug\nRunning Transaction Test\nTransaction Test Succeeded\nRunning Transaction\n\r  Installing : zabbix-release-2.4-1.el6.noarch                              1/1 \n\r  Verifying  : zabbix-release-2.4-1.el6.noarch                              1/1 \n\nInstalled:\n  zabbix-release.noarch 0:2.4-1.el6                                             \n\nComplete!\n"]}

TASK [install zabbix-agent and httpd] ******************************************
task path: /home/super_user/zabbix/task2/vm3/provision_vm3.yml:28
skipping: [vm3] => (item=[u'telnet', u'zabbix-agent', u'python-requests', u'httpd'])  => {"changed": true, "item": ["telnet", "zabbix-agent", "python-requests", "httpd"], "msg": "warning: rpmts_HdrFromFdno: Header V4 DSA/SHA1 Signature, key ID 79ea5ed4: NOKEY\nImporting GPG key 0x79EA5ED4:\n Userid : Zabbix SIA <packager@zabbix.com>\n Package: zabbix-release-2.4-1.el6.noarch (@/zabbix-release-2.4-1.el6.noarch)\n From   : /etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX\n", "rc": 0, "results": ["Loaded plugins: fastestmirror\nSetting up Install Process\nLoading mirror speeds from cached hostfile\n * base: ftp.byfly.by\n * epel: mirror.datacenter.by\n * extras: ftp.byfly.by\n * updates: ftp.byfly.by\nResolving Dependencies\n--> Running transaction check\n---> Package httpd.x86_64 0:2.2.15-47.el6.centos.4 will be installed\n--> Processing Dependency: httpd-tools = 2.2.15-47.el6.centos.4 for package: httpd-2.2.15-47.el6.centos.4.x86_64\n--> Processing Dependency: apr-util-ldap for package: httpd-2.2.15-47.el6.centos.4.x86_64\n--> Processing Dependency: /etc/mime.types for package: httpd-2.2.15-47.el6.centos.4.x86_64\n--> Processing Dependency: libaprutil-1.so.0()(64bit) for package: httpd-2.2.15-47.el6.centos.4.x86_64\n--> Processing Dependency: libapr-1.so.0()(64bit) for package: httpd-2.2.15-47.el6.centos.4.x86_64\n---> Package python-requests.noarch 0:2.6.0-3.el6 will be installed\n--> Processing Dependency: python-urllib3 >= 1.10.2-1 for package: python-requests-2.6.0-3.el6.noarch\n--> Processing Dependency: python-chardet >= 2.2.1-1 for package: python-requests-2.6.0-3.el6.noarch\n---> Package telnet.x86_64 1:0.17-48.el6 will be installed\n---> Package zabbix-agent.x86_64 0:2.4.7-1.el6 will be installed\n--> Processing Dependency: zabbix for package: zabbix-agent-2.4.7-1.el6.x86_64\n--> Running transaction check\n---> Package apr.x86_64 0:1.3.9-5.el6_2 will be installed\n---> Package apr-util.x86_64 0:1.3.9-3.el6_0.1 will be installed\n---> Package apr-util-ldap.x86_64 0:1.3.9-3.el6_0.1 will be installed\n---> Package httpd-tools.x86_64 0:2.2.15-47.el6.centos.4 will be installed\n---> Package mailcap.noarch 0:2.1.31-2.el6 will be installed\n---> Package python-chardet.noarch 0:2.2.1-1.el6 will be installed\n---> Package python-urllib3.noarch 0:1.10.2-1.el6 will be installed\n--> Processing Dependency: python-six for package: python-urllib3-1.10.2-1.el6.noarch\n--> Processing Dependency: python-backports-ssl_match_hostname for package: python-urllib3-1.10.2-1.el6.noarch\n---> Package zabbix.x86_64 0:2.4.7-1.el6 will be installed\n--> Running transaction check\n---> Package python-backports-ssl_match_hostname.noarch 0:3.4.0.2-4.el6.centos will be installed\n--> Processing Dependency: python-backports for package: python-backports-ssl_match_hostname-3.4.0.2-4.el6.centos.noarch\n---> Package python-six.noarch 0:1.9.0-2.el6 will be installed\n--> Running transaction check\n---> Package python-backports.x86_64 0:1.0-5.el6 will be installed\n--> Finished Dependency Resolution\n\nDependencies Resolved\n\n================================================================================\n Package                            Arch   Version                Repository\n                                                                           Size\n================================================================================\nInstalling:\n httpd                              x86_64 2.2.15-47.el6.centos.4 updates 831 k\n python-requests                    noarch 2.6.0-3.el6            base     95 k\n telnet                             x86_64 1:0.17-48.el6          base     58 k\n zabbix-agent                       x86_64 2.4.7-1.el6            zabbix  173 k\nInstalling for dependencies:\n apr                                x86_64 1.3.9-5.el6_2          base    123 k\n apr-util                           x86_64 1.3.9-3.el6_0.1        base     87 k\n apr-util-ldap                      x86_64 1.3.9-3.el6_0.1        base     15 k\n httpd-tools                        x86_64 2.2.15-47.el6.centos.4 updates  77 k\n mailcap                            noarch 2.1.31-2.el6           base     27 k\n python-backports                   x86_64 1.0-5.el6              base    5.5 k\n python-backports-ssl_match_hostname\n                                    noarch 3.4.0.2-4.el6.centos   extras   13 k\n python-chardet                     noarch 2.2.1-1.el6            base    230 k\n python-six                         noarch 1.9.0-2.el6            base     28 k\n python-urllib3                     noarch 1.10.2-1.el6           base    101 k\n zabbix                             x86_64 2.4.7-1.el6            zabbix  163 k\n\nTransaction Summary\n================================================================================\nInstall      15 Package(s)\n\nTotal download size: 2.0 M\nInstalled size: 6.8 M\nDownloading Packages:\n--------------------------------------------------------------------------------\nTotal                                           2.8 MB/s | 2.0 MB     00:00     \nRetrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX\nRunning rpm_check_debug\nRunning Transaction Test\nTransaction Test Succeeded\nRunning Transaction\n\r  Installing : apr-1.3.9-5.el6_2.x86_64                                    1/15 \n\r  Installing : apr-util-1.3.9-3.el6_0.1.x86_64                             2/15 \n\r  Installing : httpd-tools-2.2.15-47.el6.centos.4.x86_64                   3/15 \n\r  Installing : apr-util-ldap-1.3.9-3.el6_0.1.x86_64                        4/15 \n\r  Installing : mailcap-2.1.31-2.el6.noarch                                 5/15 \n\r  Installing : zabbix-2.4.7-1.el6.x86_64                                   6/15 \n\r  Installing : python-backports-1.0-5.el6.x86_64                           7/15 \n\r  Installing : python-backports-ssl_match_hostname-3.4.0.2-4.el6.centos    8/15 \n\r  Installing : python-chardet-2.2.1-1.el6.noarch                           9/15 \n\r  Installing : python-six-1.9.0-2.el6.noarch                              10/15 \n\r  Installing : python-urllib3-1.10.2-1.el6.noarch                         11/15 \n\r  Installing : python-requests-2.6.0-3.el6.noarch                         12/15 \n\r  Installing : zabbix-agent-2.4.7-1.el6.x86_64                            13/15 \n\r  Installing : httpd-2.2.15-47.el6.centos.4.x86_64                        14/15 \n\r  Installing : 1:telnet-0.17-48.el6.x86_64                                15/15 \n\r  Verifying  : python-six-1.9.0-2.el6.noarch                               1/15 \n\r  Verifying  : zabbix-agent-2.4.7-1.el6.x86_64                             2/15 \n\r  Verifying  : httpd-tools-2.2.15-47.el6.centos.4.x86_64                   3/15 \n\r  Verifying  : python-chardet-2.2.1-1.el6.noarch                           4/15 \n\r  Verifying  : python-requests-2.6.0-3.el6.noarch                          5/15 \n\r  Verifying  : python-backports-ssl_match_hostname-3.4.0.2-4.el6.centos    6/15 \n\r  Verifying  : apr-util-ldap-1.3.9-3.el6_0.1.x86_64                        7/15 \n\r  Verifying  : python-urllib3-1.10.2-1.el6.noarch                          8/15 \n\r  Verifying  : apr-1.3.9-5.el6_2.x86_64                                    9/15 \n\r  Verifying  : python-backports-1.0-5.el6.x86_64                          10/15 \n\r  Verifying  : zabbix-2.4.7-1.el6.x86_64                                  11/15 \n\r  Verifying  : httpd-2.2.15-47.el6.centos.4.x86_64                        12/15 \n\r  Verifying  : mailcap-2.1.31-2.el6.noarch                                13/15 \n\r  Verifying  : 1:telnet-0.17-48.el6.x86_64                                14/15 \n\r  Verifying  : apr-util-1.3.9-3.el6_0.1.x86_64                            15/15 \n\nInstalled:\n  httpd.x86_64 0:2.2.15-47.el6.centos.4   python-requests.noarch 0:2.6.0-3.el6  \n  telnet.x86_64 1:0.17-48.el6             zabbix-agent.x86_64 0:2.4.7-1.el6     \n\nDependency Installed:\n  apr.x86_64 0:1.3.9-5.el6_2                                                    \n  apr-util.x86_64 0:1.3.9-3.el6_0.1                                             \n  apr-util-ldap.x86_64 0:1.3.9-3.el6_0.1                                        \n  httpd-tools.x86_64 0:2.2.15-47.el6.centos.4                                   \n  mailcap.noarch 0:2.1.31-2.el6                                                 \n  python-backports.x86_64 0:1.0-5.el6                                           \n  python-backports-ssl_match_hostname.noarch 0:3.4.0.2-4.el6.centos             \n  python-chardet.noarch 0:2.2.1-1.el6                                           \n  python-six.noarch 0:1.9.0-2.el6                                               \n  python-urllib3.noarch 0:1.10.2-1.el6                                          \n  zabbix.x86_64 0:2.4.7-1.el6                                                   \n\nComplete!\n"]}

TASK [file] ********************************************************************
task path: /home/super_user/zabbix/task2/vm3/provision_vm3.yml:38
changed: [vm3] => {"changed": true, "gid": 0, "group": "root", "mode": "0755", "owner": "root", "path": "/var/log/httpd", "size": 4096, "state": "directory", "uid": 0}

TASK [register eth1 ip address] ************************************************
task path: /home/super_user/zabbix/task2/vm3/provision_vm3.yml:40
changed: [vm3] => {"changed": true, "cmd": "ifconfig eth1 | grep 'inet addr:' | cut -d: -f2 | awk '{ print $1}'", "delta": "0:00:00.004430", "end": "2016-04-26 21:41:03.919127", "rc": 0, "start": "2016-04-26 21:41:03.914697", "stderr": "", "stdout": "192.168.33.13", "stdout_lines": ["192.168.33.13"], "warnings": []}

TASK [configure zabbix agent] **************************************************
task path: /home/super_user/zabbix/task2/vm3/provision_vm3.yml:45
changed: [vm3] => {"changed": true, "checksum": "6bf8e6a17c82c0f5e1fe08c11e0ca58de9b441d7", "dest": "/etc/zabbix/zabbix_agentd.conf", "gid": 0, "group": "root", "md5sum": "f16f8539eebd847603b6615342117d73", "mode": "0644", "owner": "root", "size": 7991, "src": "/home/vagrant/.ansible/tmp/ansible-tmp-1461703263.96-146818892437385/source", "state": "file", "uid": 0}

TASK [copy python script] ******************************************************
task path: /home/super_user/zabbix/task2/vm3/provision_vm3.yml:48
changed: [vm3] => {"changed": true, "checksum": "a7868ea9942a10b637da217ed0071d8f23da931f", "dest": "/tmp/zabbix.py", "gid": 500, "group": "vagrant", "md5sum": "9a487333433ec7307263dfdc4da7aff4", "mode": "0744", "owner": "vagrant", "size": 1960, "src": "/home/vagrant/.ansible/tmp/ansible-tmp-1461703265.03-244711571704651/source", "state": "file", "uid": 500}

TASK [register zabbix-agent on server] *****************************************
task path: /home/super_user/zabbix/task2/vm3/provision_vm3.yml:51
changed: [vm3] => {"changed": true, "cmd": ["/tmp/zabbix.py", "zabbix-vm3", "192.168.33.13", "2", "Admin", "zabbix", "10108", "http://zabbix-server/api_jsonrpc.php"], "delta": "0:00:00.292281", "end": "2016-04-26 21:41:06.178443", "rc": 0, "start": "2016-04-26 21:41:05.886162", "stderr": "", "stdout": "", "stdout_lines": [], "warnings": []}

TASK [start and enable zabbix-agent] *******************************************
task path: /home/super_user/zabbix/task2/vm3/provision_vm3.yml:54
changed: [vm3] => (item=httpd) => {"changed": true, "enabled": true, "item": "httpd", "name": "httpd", "state": "started"}
changed: [vm3] => (item=zabbix-agent) => {"changed": true, "enabled": true, "item": "zabbix-agent", "name": "zabbix-agent", "state": "started"}

PLAY RECAP *********************************************************************
vm3                        : ok=11   changed=9    unreachable=0    failed=0   

